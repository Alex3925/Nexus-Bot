# Nexus Bot

> **Version:** 1.2.0  
> **Codename:** Ignition X

<p align="center">
  <img src="https://i.ibb.co/GfPHJL0C/Future-Studio-Synthwave-Logo-Standard.png" alt="Nexus Bot Logo" width="400" height="400">
</p>

<p align="center">
  <b>A Powerful, Optimized Messenger Bot Framework</b>
</p>

<p align="center">
  <a href="#features">Features</a> •
  <a href="#installation">Installation</a> •
  <a href="#configuration">Configuration</a> •
  <a href="#usage">Usage</a> •
  <a href="#commands">Commands</a> •
</p>

## 📋 Overview

Nexus is a high-performance framework for building Facebook Messenger bots. It provides a robust infrastructure with automatic recovery, performance optimization, and easy-to-use command and event systems.

**Project Structure:**
```
Nexus/
├── appstate.json           # Facebook appstate (login credentials)
├── config.json             # Main config
├── package.json            # Node.js dependencies and scripts
├── index.js                # Main entry point
├── commands/               # Command modules
├── events/                 # Event handlers
├── nexus-core/             # Core logic, database, utils, etc.
├── database/               # SQLite DB, backups, temp
├── docs/                   # Documentation
├── logs/                   # Log files
├── temp/                   # Temporary files
├── Fca_Database/           # (Optional) FCA database Auto Generated by Nexus-fCA
└── ... (other folders/files as needed)
```

## 🆕 Recent Updates

### Nexus The Lab Update #1.1.0 Curent Version: 1.2.0

- **New Laboratory Features**
  - Enhanced experimental command testing environment
  - Advanced debugging tools for developers
  - Real-time performance monitoring dashboard

- **System Improvements**
  - Improved thread management system
  - Enhanced security protocols

- **Developer Tools**
  - Added command creation wizard
  - Integrated testing framework
  - New development documentation

### Optimizations & Improvements

- **Memory Management**
  - Added advanced memory monitoring and auto-cleanup
  - Implemented garbage collection triggers for high memory usage
  - Reduced memory leaks with strategic cache clearing

- **Performance Enhancements**
  - Command queue system to prevent rate limiting
  - Optimized event handling with minimal overhead
  - Reduced redundant API calls (typing indicators, message delivery)

- **Error Handling**
  - Enhanced error tracking with automatic recovery
  - Added graceful fallbacks for critical functions
  - Centralized error logging and notification system

- **Configuration Management**
  - Centralized configuration with deep merging
  - Added default values for all settings
  - Improved access with path-based getter

- **Auto-Recovery System**
  - Implemented restart markers for smooth recovery
  - Added periodic restart options for long-term stability
  - Error threshold monitoring for automatic restarts

- **Code Structure**
  - Reduced redundancy across modules
  - Improved modularity with focused responsibilities
  - Better separation of concerns (API, Database, Events)

## ✨ Features

- **Command System**
  - Easy-to-create commands with role-based permissions
  - Hot-reloading for commands during development
  - Command cooldowns and rate limiting

- **Event System**
  - Modular event handling for different message types
  - Customizable event responses
  - Event filtering and prioritization

- **Permission System**
  - Multi-level role-based permissions (User, Admin, Owner)
  - Group-specific permissions
  - Thread administrator detection

- **Database Integration**
  - SQLite database with automatic backups and recovery
  - Optional GitHub synchronization

- **API Management**
  - Safe wrapper functions for Facebook API
  - Rate limiting and throttling
  - Error resilience

## 🛠️ Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/Nexus-016/Nexus-Bot.git
   cd nexus-bot
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Configure the bot**
   - Copy `config.example.json` to `config.json`
   - Edit the configuration file with your settings
   - Add your Facebook credentials to `appstate.json`

4. **Set up the database**
   - Ensure your SQLite database is properly configured.

5. **Start the bot**
   ```bash
   npm start
   ```

## ⚙️ Configuration

Nexus Bot uses a centralized configuration system. The main settings are:

```json
{
  "name": "NexusBot",
  "prefix": "!",
  "admins": ["YOUR_FACEBOOK_ID"],
  "permissions": {
    "owner": "YOUR_FACEBOOK_ID"
  },
  "system": {
    "autoRestart": {
      "enabled": true,
      "memoryThreshold": 500,
      "interval": 21600000
    }
  }
}
```

See the [Configuration Guide](docs/configuration.md) for all available options.

## 📝 Usage

### Creating Commands

1. Create a new file in the `commands` directory:

```javascript
// commands/hello.js
module.exports = {
  config: {
    name: "hello",
    aliases: ["hi", "hey"],
    version: "1.0.0",
    author: "YourName",
    countDown: 5,
    role: 0,
    shortDescription: "Say hello",
    longDescription: "A friendly greeting command",
    category: "general",
    guide: "{prefix}hello [name]"
  },
  execute: async function({ api, event, args }) {
    const name = args[0] || "friend";
    return api.sendMessage(`Hello, ${name}!`, event.threadID);
  }
};
```

### Adding Events

Create a new file in the `events` directory:

```javascript
// events/welcome.js
module.exports = {
  config: {
    name: "welcome",
    version: "1.0.0",
    description: "Welcome new members"
  },
  execute: async function({ api, event, config }) {
    if (event.type === "add_participants") {
      const msg = `Welcome to the group!`;
      return api.sendMessage(msg, event.threadID);
    }
  }
};
```

### Using the Feature Toggle Command

The `feature-toggle` command allows you to enable or disable specific features at runtime.

- **List all features and their status:**
  ```bash
  {prefix}feature-toggle
  # or
  {prefix}feature-toggle list
  ```
- **Enable a feature:**
  ```bash
  {prefix}feature-toggle <feature-name> enable
  ```
- **Disable a feature:**
  ```bash
  {prefix}feature-toggle <feature-name> disable
  ```
- **Example:**
  ```bash
  !feature-toggle analytics enable
  !feature-toggle autoModeration disable
  ```

### Memory and Performance Management

Nexus Bot uses the `optimization.js` module for advanced memory and performance management:
- **Automatic memory monitoring**: Periodically checks memory usage and triggers garbage collection if needed.
- **Error tracking**: Logs uncaught exceptions and unhandled promise rejections.
- **Periodic memory cleanup**: Cleans up caches and unused resources every 30 minutes by default.

**To enable garbage collection, run Node.js with the `--expose-gc` flag:**
```bash
node --expose-gc index.js
```

You can adjust memory thresholds and cleanup intervals in your `config.json` and `optimization.js`.

## 📂 Project Structure

```
nexus-bot/
├── commands/          # Bot commands
├── events/            # Event handlers
├── core/              # Core functionality
├── utils/             # Utility functions
├── database/          # Database files and backups
├── modules/           # Additional modules
├── logs/              # Log files
├── config.json        # Configuration file
├── appstate.json      # Facebook authentication
└── index.js           # Main entry point
```

## 📚 Commands

The bot comes with several built-in commands:

- `help` - Show available commands
- `admin` - Admin control panel
- `info` - Show bot information
- `restart` - Restart the bot
- `update` - Update the bot from GitHub

See the [Commands Guide](docs/commands.md) for more details.

## 🛠️ Database Maintenance

### Health Check
The bot automatically performs a database health check during initialization to ensure schema consistency.

### Cleanup Script
To remove stale data from the database, run the cleanup script:
```bash
npm run db:cleanup
```

### Database Inspection
To inspect and manage your database, use SQLite-compatible tools.

### Migrations
Ensure your database schema is up-to-date.

## Memory and Performance Management

Nexus Bot uses the `optimization.js` module for advanced memory and performance management:
- Automatic memory monitoring and cleanup
- Periodic garbage collection (every 30 minutes)
- Auto-restart if memory usage exceeds threshold

No manual action is required, but you can review or adjust settings in `config.json` under `system.performance` and `system.autoRestart`.

## Periodic Memory Cleanup

Memory cleanup and garbage collection are handled automatically. For custom intervals, edit the schedule in `utils/optimization.js`.

## 🤝 Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## 📄 License

This project is licensed under the MIT License - see the LICENSE file for details.

## 🙏 Acknowledgements

- # nexus-fca Troubleshooting & Tips

// This document is obsolete after migration to nexus-fca. Please refer to the new API docs for nexus-fca usage and troubleshooting.
// ## Nexus fca can be found on [npm](https://www.npmjs.com/package/nexus-fca) and [GitHub](https://github.com/Nexus-016/Nexus-fCA)

- All the contributors and testers
